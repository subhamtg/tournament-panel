<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 font-sans">

<!-- Header for mobile -->
<header class="md:hidden flex items-center justify-between bg-blue-600 text-white p-4">
  <h1 class="text-xl font-bold">Dashboard</h1>
  <button onclick="toggleSidebar()" class="focus:outline-none">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
         viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>
</header>

<!-- Sidebar -->
<div id="sidebar" class="fixed md:static z-50 top-0 left-0 w-64 h-full bg-gradient-to-br from-blue-600 to-purple-600 text-white p-6 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
  <h2 class="text-2xl font-bold mb-6 hidden md:block">Dashboard</h2>
  <nav class="space-y-4">
    <button onclick="showTab('profile')" class="block w-full text-left hover:underline">ğŸ‘¤ Profile</button>
    <button onclick="showTab('edit')" class="block w-full text-left hover:underline">âœï¸ Edit Info</button>
    <button onclick="showTab('password')" class="block w-full text-left hover:underline">ğŸ”’ Change Password</button>
    <button onclick="showTab('notifications')" class="block w-full text-left hover:underline">ğŸ”” Notifications</button>
    <button onclick="showTab('support')" class="block w-full text-left hover:underline">ğŸ“¨ Messages</button>
    <button onclick="logout()" class="block w-full text-left text-red-400 hover:underline">ğŸšª Logout</button>
  </nav>
</div>

<!-- Main Content -->
<div class="md:ml-64 p-4 md:p-8">
  <!-- Profile -->
  <div id="profile" class="tab">
    <h2 class="text-2xl font-semibold mb-4">ğŸ‘¤ Welcome, <span id="username">Loading...</span></h2>
    <p>Email: <span id="email">Loading...</span></p>
    <p>Mobile: <span id="mobile">Loading...</span></p>
  </div>

  <!-- Edit Info -->
  <div id="edit" class="tab hidden">
    <h2 class="text-2xl font-semibold mb-4">âœï¸ Edit Info</h2>
    <form class="space-y-4" onsubmit="event.preventDefault(); updateInfo();">
      <input id="newName" type="text" placeholder="New Name" class="w-full p-2 border rounded" />
      <input id="newEmail" type="email" placeholder="New Email" class="w-full p-2 border rounded" />
      <input id="newMobile" type="tel" placeholder="New Mobile Number" class="w-full p-2 border rounded" />
      <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Update Info</button>
    </form>
  </div>

  <!-- Change Password -->
  <div id="password" class="tab hidden">
    <h2 class="text-2xl font-semibold mb-4">ğŸ”’ Change Password</h2>
    <form class="space-y-4" onsubmit="event.preventDefault(); changePassword();">
      <input id="oldPassword" type="password" placeholder="Old Password" class="w-full p-2 border rounded" />
      <input id="newPassword" type="password" placeholder="New Password" class="w-full p-2 border rounded" />
      <input id="confirmPassword" type="password" placeholder="Confirm New Password" class="w-full p-2 border rounded" />
      <button class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">Change Password</button>
    </form>
  </div>

  <!-- Notifications -->
  <div id="notifications" class="tab hidden">
    <h2 class="text-2xl font-semibold mb-4">ğŸ”” Notifications</h2>
    <ul class="list-disc pl-6 space-y-2">
      <li>ğŸ“… Your subscription renews in 5 days.</li>
      <li>âœ… Profile updated successfully.</li>
      <li>ğŸ›¡ï¸ Password changed last week.</li>
    </ul>
  </div>

  <!-- Support/Messages -->
  <div id="support" class="tab hidden">
    <h2 class="text-2xl font-semibold mb-4">ğŸ“¨ Support / Messages</h2>
    <form class="space-y-4">
      <textarea placeholder="Type your message..." class="w-full p-2 border rounded h-32"></textarea>
      <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Send Message</button>
    </form>
  </div>
</div>

<!-- JavaScript -->
<script>
  const supabase = supabase.createClient(
    'https://your-project.supabase.co', // Replace with your Supabase URL
    'public-anon-key' // Replace with your Supabase anon/public key
  );

  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('-translate-x-full');
  }

  function showTab(tabId) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.add('hidden'));
    document.getElementById(tabId).classList.remove('hidden');
    localStorage.setItem('activeTab', tabId);
    if (window.innerWidth < 768) toggleSidebar(); // auto-close on mobile
  }

  window.onload = async function () {
    showTab(localStorage.getItem('activeTab') || 'profile');

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      alert("Not logged in!");
      window.location.href = "/login";
      return;
    }

    const { name, mobile } = user.user_metadata || {};
    document.getElementById("username").textContent = name || "No Name";
    document.getElementById("email").textContent = user.email || "No Email";
    document.getElementById("mobile").textContent = mobile || "Not Provided";
  };

  async function updateInfo() {
    const name = document.getElementById("newName").value;
    const email = document.getElementById("newEmail").value;
    const mobile = document.getElementById("newMobile").value;

    const { error } = await supabase.auth.updateUser({
      email,
      data: { name, mobile }
    });

    if (error) {
      alert("Error updating profile: " + error.message);
    } else {
      alert("Profile updated!");
      location.reload();
    }
  }

  async function changePassword() {
    const newPassword = document.getElementById("newPassword").value;
    const confirmPassword = document.getElementById("confirmPassword").value;

    if (newPassword !== confirmPassword) {
      alert("Passwords do not match!");
      return;
    }

    const { error } = await supabase.auth.updateUser({
      password: newPassword
    });

    if (error) {
      alert("Error changing password: " + error.message);
    } else {
      alert("Password changed successfully!");
    }
  }

  async function logout() {
    await supabase.auth.signOut();
    alert("You have been logged out!");
    window.location.href = "/login";
  }
</script>

</body>
</html>
